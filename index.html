<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kovu: #CommunityRescue Arena MVP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-wrapper">
        <div id="game-container">
            <div id="intro-overlay">
                <div class="intro-panel active" id="intro-1" data-panel="1">
                    <img src="https://placehold.co/400x200/333333/cccccc?text=Abandoned+Kovu" alt="Abandoned Kovu" onerror="this.src='https://placehold.co/400x200/333333/cccccc?text=Image+Error'">
                    <p>Abandoned... like a delisted coin. Colors faded, feeling worthless...</p>
                    <button data-next="2">Next</button>
                </div>
                <div class="intro-panel" id="intro-2" data-panel="2">
                    <img src="https://placehold.co/400x200/555555/dddddd?text=KCC+Rescue" alt="KCC Rescue" onerror="this.src='https://placehold.co/400x200/555555/dddddd?text=Image+Error'">
                    <p>"Subject Kovu located. Vital signs critical. Initiating community rescue protocol." The KCC found me.</p>
                    <button data-next="3">Next</button>
                </div>
                <div class="intro-panel" id="intro-3" data-panel="3">
                    <img src="https://placehold.co/400x200/1a1a2e/00ffff?text=Upgrade+Bay" alt="Upgrade Bay" onerror="this.src='https://placehold.co/400x200/1a1a2e/00ffff?text=Image+Error'">
                    <p>"The Community pooled resources... gave you upgrades! This 'Community Link' keeps us connected. Think of it as your personal live feed!"</p>
                    <button data-next="4">Next</button>
                </div>
                <div class="intro-panel" id="intro-4" data-panel="4">
                    <img src="https://placehold.co/400x200/0f3460/ffffff?text=Entering+Arena" alt="Entering Arena" onerror="this.src='https://placehold.co/400x200/0f3460/ffffff?text=Image+Error'">
                    <p>"Go out there, engage, climb the ranks! We'll be watching. Make us proud!" ... A second chance?</p>
                    <button data-next="start">Enter the Arena!</button>
                </div>
            </div>
            <div id="level-transition-overlay">
                <h2>Level Complete!</h2>
                <p>Prepare for the next challenge...</p>
            </div>
            <div id="game-over-overlay">
                <h2>Game Over!</h2>
                <p>Community approval dropped too low. Try again?</p>
                <button id="restart-button">Restart</button>
            </div>
            <div id="tutorial-overlay">
                <div class="tutorial-panel" id="tutorial-1" data-panel="1">
                    <h2>Welcome to the Arena!</h2>
                    <p>Your goal is to collect data packets while avoiding hazards and rivals.</p>
                    <div class="hazard-demo" style="top: 30%; left: 50%; transform: translate(-50%, -50%);"></div>
                    <p>Watch out for red hazard zones! They'll drain your approval rating.</p>
                    <button data-next="2">Next</button>
                </div>
                <div class="tutorial-panel" id="tutorial-2" data-panel="2">
                    <h2>Controls</h2>
                    <p>Use the joystick or arrow keys to move.</p>
                    <p>Tap the screen or press SPACE to dash away from danger.</p>
                    <p>Use the laser button or press E to destroy rivals.</p>
                    <button data-next="3">Next</button>
                </div>
                <div class="tutorial-panel" id="tutorial-3" data-panel="3">
                    <h2>Gameplay Tips</h2>
                    <p>Collect all data packets to activate the target zone.</p>
                    <p>Destroy rivals to clear your path.</p>
                    <p>Keep your approval rating above zero!</p>
                    <button data-next="start">Begin!</button>
                </div>
            </div>
            <canvas id="gameCanvas"></canvas>
            <div id="ui-container">
                <div id="ui-left">
                    <div id="kcc-status">ðŸ”´<span>OFFLINE</span></div>
                    <div id="level-indicator">Level: 1</div>
                </div>
                <div id="ui-right">
                    <div id="approval-meter-container">
                        Community Approval:
                        <progress id="approval-meter" value="10" max="100"></progress>
                    </div>
                    <div id="objective-display">Objective: Collect Data! (0/0)</div>
                    <div id="enemy-count">Rivals Destroyed: 0/0</div>
                </div>
            </div>
            <div id="feedback-area"></div>
            <div id="win-message">
                <h2>All Levels Complete!</h2>
                <p>#KovuWins! The Community is ecstatic!</p>
                <button id="play-again-button">Play Again?</button>
            </div>
            <div id="mobile-tutorial">Tap on screen to dash</div>
            <div id="touch-controls-container">
                <div id="joystick-area">
                    <div id="joystick-base"></div>
                    <div id="joystick-knob"></div>
                </div>
                <div id="laser-button">
                    <div class="laser-button-inner"></div>
                </div>
            </div>
        </div>
        <div id="controls-hint">Controls: Arrow Keys/WASD/Joystick, Space/Touch to Dash, E/Touch to Fire Laser</div>
    </div>

    <script type="module">
        import { Game } from '/js/Game.js';
        
        window.addEventListener('load', async () => {
            const game = new Game();
            await game.initialize();
        });
    </script>
</body>
</html>
